parameters:
    sylius.order_fields:
        - "CreatedAt"
        - "UpdatedAt"
        - "CheckoutCompletedAt"
        - "CheckoutState"
        - "Shipments"
        - "ShippingRequired"
        - "ShippingState"
        - "ShippingAddress"
        - "BillingAddress"
        - "Number"
        - "Notes"
        - "Items"
        - "ItemsTotal"
        - "Total"
        - "State"
        - "Adjustments"
        - "Customer"
        - "Payments"
        - "PaymentState"
        - "CurrencyCode"
        - "LocaleCode"
        - "TokenValue"
        - "CustomerIp"
        - "Channel"
    sylius.order_states_applicable_to_import:
        - "new"
        - "fulfilled"
    sylius.order.always_create_new: true

services:
    sylius.exporter.orders.json:
        class: FriendsOfSylius\SyliusImportExportPlugin\Exporter\JsonResourceExporter
        arguments:
            - "@sylius.exporter.pluginpool.orders"
            - "%sylius.order_fields%"
            - "@sylius.exporters_transformer_pool"
        tags:
            - { name: sylius.exporter, type: sylius.order, format: json }

    sylius.exporter.pluginpool.orders:
        class: FriendsOfSylius\SyliusImportExportPlugin\Exporter\Plugin\PluginPool
        arguments:
            - ["@sylius.exporter.plugin.resource.orders"]
            - "%sylius.order_fields%"

    sylius.exporter.plugin.resource.orders:
        class: FriendsOfSylius\SyliusImportExportPlugin\Exporter\Plugin\OrderResourcePlugin
        arguments:
            - "@sylius.repository.order"
            - "@property_accessor"
            - "@doctrine.orm.entity_manager"
            - '@FriendsOfSylius\SyliusImportExportPlugin\Formatter\DateTimeFormatter'

    sylius.processor.orders:
        class: FriendsOfSylius\SyliusImportExportPlugin\Processor\OrderProcessor
        autowire: true
        arguments:
            $dateTimeFormatter: '@FriendsOfSylius\SyliusImportExportPlugin\Formatter\DateTimeFormatter'
            $metadataValidator: "@sylius.importer.metadata_validator"
            $orderStatesApplicableToImport: "%sylius.order_states_applicable_to_import%"
            $alwaysCreateNew: "%sylius.order.always_create_new%"
            $headerKeys: "%sylius.order_fields%"

    sylius.importer.orders.json:
        class: FriendsOfSylius\SyliusImportExportPlugin\Importer\JsonResourceImporter
        arguments:
            - "@sylius.manager.order"
            - "@sylius.processor.orders"
            - "@sylius.importer.result"
            - "%sylius.importer.batch_size%"
            - "%sylius.importer.fail_on_incomplete%"
            - "%sylius.importer.stop_on_failure%"
        tags:
            - { name: sylius.importer, type: order, format: json }
